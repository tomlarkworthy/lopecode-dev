{"cmd": "load", "notebook": "lopecode/lopebooks/notebooks/@tomlarkworthy_opencode-agent.html", "hash": "view=R100(S50(@tomlarkworthy/reactive-reflective-testing),S50(@tomlarkworthy/exporter-2))"}
{"cmd": "define-variable", "name": "generateId", "definition": "() => (() => crypto.randomUUID())", "inputs": [], "module": "@tomlarkworthy/tests"}
{"cmd": "define-variable", "name": "createUserMessage", "definition": "(generateId) => ({ sessionId, agent, providerId, modelId, system, tools }) => ({ id: generateId(), sessionId, role: 'user', time: { created: Date.now() }, agent, model: { providerId, modelId }, system, tools })", "inputs": ["generateId"], "module": "@tomlarkworthy/tests"}
{"cmd": "define-variable", "name": "createAssistantMessage", "definition": "(generateId) => ({ sessionId, parentId, agent, providerId, modelId }) => ({ id: generateId(), sessionId, role: 'assistant', time: { created: Date.now(), completed: null }, parentId, agent, providerId, modelId, error: null, cost: 0, tokens: { input: 0, output: 0, reasoning: 0, cache: { read: 0, write: 0 } }, finish: null })", "inputs": ["generateId"], "module": "@tomlarkworthy/tests"}
{"cmd": "define-variable", "name": "test_opencode_generateId", "definition": "(generateId) => { const id = generateId(); if (typeof id !== 'string' || id.length < 30) throw new Error('bad id: ' + typeof id); return 'pass'; }", "inputs": ["generateId"], "module": "@tomlarkworthy/tests"}
{"cmd": "define-variable", "name": "test_opencode_createUserMessage", "definition": "(createUserMessage) => { const msg = createUserMessage({ sessionId: 'test', agent: 'user', providerId: 'anthropic', modelId: 'claude' }); if (!msg.id || msg.role !== 'user') throw new Error('failed: ' + JSON.stringify(msg)); return 'pass'; }", "inputs": ["createUserMessage"], "module": "@tomlarkworthy/tests"}
{"cmd": "define-variable", "name": "test_opencode_createAssistantMessage", "definition": "(createAssistantMessage) => { const msg = createAssistantMessage({ sessionId: 'test', parentId: 'p1', agent: 'assistant', providerId: 'anthropic', modelId: 'claude' }); if (!msg.id || msg.role !== 'assistant') throw new Error('failed'); return 'pass'; }", "inputs": ["createAssistantMessage"], "module": "@tomlarkworthy/tests"}
{"cmd": "run-tests", "filter": "test_opencode", "timeout": 15000}
{"cmd": "quit"}
